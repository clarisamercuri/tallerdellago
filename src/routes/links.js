const express = require('express');
const router = express.Router();
var fs = require('fs')
var multer = require('multer');
var path = require('path');
const { doesNotMatch } = require('assert');


var storage = multer.diskStorage({
  destination: './public/pdf/ordenes',
  filename: function (req, file, cb) {
    cb(null, file.originalname);
}
})

var upload = multer({storage: storage,  limits: { fieldSize: 10 * 1024 * 1024 }});

var logosrc='data:image/png;base64,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'
const pool = require('../database');
const { isLoggedIn } = require('../lib/auth');


router.get('/detallepresupuesto/:dominio', isLoggedIn, async (req, res) => {
    const { dominio } = req.params;
    const orden = await pool.query('SELECT *, DATE_FORMAT(fecha_turno_i, "%d/%m/%y") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%d/%m/%y") AS fecha_turno_f FROM ordenes WHERE dominio = ?', [dominio]);
    res.json({orden})
  });

  router.get('/detalleregistro/:dominio', isLoggedIn, async (req, res) => {
    const { dominio } = req.params;
  const presupuestos = await pool.query('SELECT *,  DATE_FORMAT(fecha_turno_i, "%d/%m/%y") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%d/%m/%y") AS fecha_turno_f, DATE_FORMAT(fecha_ingreso, "%d/%m/%y") AS fecha_ingreso FROM presupuestos WHERE dominio = ? AND  numero_pres = 1', [dominio]);
    const orden = await pool.query('SELECT *, DATE_FORMAT(fecha_turno_i, "%d/%m/%y") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%d/%m/%y") AS fecha_turno_f FROM ordenes WHERE dominio = ?', [dominio]);
    res.render('links/detalleregistro', { presupuestos, orden });
  });

router.get('/ordenes', isLoggedIn, async (req, res) => {
 const presupuestos = await pool.query('SELECT *, DATE_FORMAT(fecha_ingreso, "%d/%m/%Y") AS fecha_ingreso, DATE_FORMAT(fecha_turno_i, "%d/%m/%Y") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%d/%m/%Y") AS fecha_turno_f FROM presupuestos WHERE numero_pres = 1');

    res.render('links/ordenes', {  presupuestos });

});

//NUEVOS PRESUPUESTOS

router.get('/nuevopresupuesto', isLoggedIn, async  (req, res) => {
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const piezas = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
    res.render('links/nuevopresupuesto', { valoresconfig, piezas });
});

router.get('/nuevopresupuestomob', isLoggedIn, async  (req, res) => {
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const piezas = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
    res.render('links/nuevopresupuestomob', { valoresconfig, piezas });
});

router.get('/nuevopresupuestocliente/:dominio', isLoggedIn, async  (req, res) => {
  const {dominio} = req.params;
  const valorescliente = await pool.query('SELECT * FROM presupuestos WHERE dominio = ? AND numero_pres = ?', [dominio, 1]);
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const piezas = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
    res.render('links/nuevopresupuestocliente', { valorescliente, valoresconfig, piezas });
});


router.get('/nuevopresupuestoclientemob/:dominio', isLoggedIn, async  (req, res) => {
  const {dominio} = req.params;
  const valorescliente = await pool.query('SELECT * FROM presupuestos WHERE dominio = ? AND numero_pres = ?', [dominio, 1]);
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const piezas = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
    res.render('links/nuevopresupuestoclientemob', { valorescliente, valoresconfig, piezas });
});

router.get('/editarpresupuesto/:dominio/:rutapdf/:npresupuesto', isLoggedIn, async  (req, res) => {
  const {dominio, rutapdf,npresupuesto} = req.params;
  const valorescliente = await pool.query('SELECT * FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, rutapdf]);
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const piezas = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
    res.render('links/editarpresupuesto', { valorescliente, valoresconfig, piezas, npresupuesto});
});

router.get('/editarpresupuestomob/:dominio/:rutapdf/:npresupuesto', isLoggedIn, async  (req, res) => {
  const {dominio, rutapdf,npresupuesto} = req.params;
  const valorescliente = await pool.query('SELECT * FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, rutapdf]);
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const piezas = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
    res.render('links/editarpresupuestomob', { valorescliente, valoresconfig, piezas, npresupuesto});
});

router.post('/editarpresupuesto/:n_presupuesto',isLoggedIn, async (req, res) => {
  var chapa_reparar_sql = [];
  var pintura_reparar_sql = [];
  var mecanica_reparar_sql = [];
  var repuesto_reparar_sql = [];
  var chapa_cambiar_sql = [];
  var pintura_cambiar_sql = [];
  var mecanica_cambiar_sql = [];
  var repuesto_cambiar_sql = [];
if (req.body.pieza_reparar != undefined){
    if (typeof req.body.pieza_reparar != 'string'){

  for (i=0;i<req.body.pieza_reparar.length;i++){
    if (req.body.chapa_reparar[i] != '') {
      chapa_reparar_sql.push(req.body.chapa_reparar[i])
    } else if (req.body.chapa_reparar[i] == ''){
      chapa_reparar_sql.push(' ')
    }
    if (req.body.pintura_reparar[i] != '') {
      pintura_reparar_sql.push(req.body.pintura_reparar[i])
    } else if (req.body.pintura_reparar[i] == ''){
      pintura_reparar_sql.push(' ')
    }
    if (req.body.mecanica_reparar[i] != '') {
      mecanica_reparar_sql.push(req.body.mecanica_reparar[i])
    } else if (req.body.mecanica_reparar[i] == ''){
      mecanica_reparar_sql.push(' ')
    }
    if (req.body.repuesto_reparar[i] != '') {
      repuesto_reparar_sql.push(req.body.repuesto_reparar[i])
    } else if (req.body.repuesto_reparar[i] == ''){
      repuesto_reparar_sql.push(' ')
    }

  }
  } else {
    if (req.body.chapa_reparar != '') {
      chapa_reparar_sql.push(req.body.chapa_reparar)
    } else if (req.body.chapa_reparar == ''){
      chapa_reparar_sql.push(' ')
    }
    if (req.body.pintura_reparar != '') {
      pintura_reparar_sql.push(req.body.pintura_reparar)
    } else if (req.body.pintura_reparar == ''){
      pintura_reparar_sql.push(' ')
    }
    if (req.body.mecanica_reparar != '') {
      mecanica_reparar_sql.push(req.body.mecanica_reparar)
    } else if (req.body.mecanica_reparar == ''){
      mecanica_reparar_sql.push(' ')
    }
    if (req.body.repuesto_reparar != '') {
      repuesto_reparar_sql.push(req.body.repuesto_reparar)
    } else if (req.body.repuesto_reparar == ''){
      repuesto_reparar_sql.push(' ')
    }
  }
}
if (req.body.pieza_cambiar != undefined){
    if (typeof req.body.pieza_cambiar != 'string'){

for (j=0;j<req.body.pieza_cambiar.length;j++){
  if (req.body.chapa_cambiar[j] != '') {
    chapa_cambiar_sql.push(req.body.chapa_cambiar[j])
  } else if (req.body.chapa_cambiar[j] == ''){
    chapa_cambiar_sql.push(' ')
  }
  if (req.body.pintura_cambiar[j] != '') {
    pintura_cambiar_sql.push(req.body.pintura_cambiar[j])
  } else if (req.body.pintura_cambiar[j] == ''){
    pintura_cambiar_sql.push(' ')
  }
  if (req.body.mecanica_cambiar[j] != '') {
    mecanica_cambiar_sql.push(req.body.mecanica_cambiar[j])
  } else if (req.body.mecanica_cambiar[j] == ''){
    mecanica_cambiar_sql.push(' ')
  }
  if (req.body.repuesto_cambiar[j] != '') {
    repuesto_cambiar_sql.push(req.body.repuesto_cambiar[j])
  } else if (req.body.repuesto_cambiar[j] == ''){
    repuesto_cambiar_sql.push(' ')
  }
}
    } else {
      if (req.body.chapa_cambiar != '') {
        chapa_cambiar_sql.push(req.body.chapa_cambiar)
      } else if (req.body.chapa_cambiar == ''){
        chapa_cambiar_sql.push(' ')
      }
      if (req.body.pintura_cambiar != '') {
        pintura_cambiar_sql.push(req.body.pintura_cambiar)
      } else if (req.body.pintura_cambiar == ''){
        pintura_cambiar_sql.push(' ')
      }
      if (req.body.mecanica_cambiar != '') {
        mecanica_cambiar_sql.push(req.body.mecanica_cambiar)
      } else if (req.body.mecanica_cambiar == ''){
        mecanica_cambiar_sql.push(' ')
      }
      if (req.body.repuesto_cambiar != '') {
        repuesto_cambiar_sql.push(req.body.repuesto_cambiar)
      } else if (req.body.repuesto_cambiar == ''){
        repuesto_cambiar_sql.push(' ')
      }
    }
}
const chapa_reparar = JSON.stringify(chapa_reparar_sql)
const pieza_reparar = JSON.stringify(req.body.pieza_reparar)
const pintura_reparar = JSON.stringify(pintura_reparar_sql)
const mecanica_reparar = JSON.stringify(mecanica_reparar_sql)
const repuesto_reparar = JSON.stringify(repuesto_reparar_sql)
const pieza_cambiar = JSON.stringify(req.body.pieza_cambiar)
const chapa_cambiar = JSON.stringify(chapa_cambiar_sql)
const pintura_cambiar = JSON.stringify(pintura_cambiar_sql)
const mecanica_cambiar = JSON.stringify(mecanica_cambiar_sql)
const repuesto_cambiar = JSON.stringify(repuesto_cambiar_sql)

  const n_presupuesto = req.body.n_pres;
  if (req.body.observacion == ''){
    var { nombre,
     
      telefono,
      marca,
      modelo,
      dominio,
      color,
      total_presupuesto,
      franquicia: franquicia,
     particular,
nombre_presupuesto,
n_pres
 } = req.body;
 var observacion = null;
  } else {
  var { nombre,
            telefono,
       marca,
       modelo,
       dominio,
       color,
       total_presupuesto,
       franquicia: franquicia,
     particular,
       observacion,
nombre_presupuesto,
n_pres
  } = req.body;
  await pool.query("UPDATE ordenes SET observacion_"+n_presupuesto+" = ? WHERE dominio = ?", [ observacion, dominio]);
}
if (particular == 1){
var compania = 'Particular';
var siniestro = '';
} else {
var compania = req.body.compania;
var siniestro = req.body.siniestro;
}
  const config = await pool.query('SELECT * FROM configuracion');
  const fecha_ingreso_nueva = new Date().toISOString().slice(0, 19).replace('T', ' ');

let date = new Date()

let day = date.getDate()
let month = date.getMonth() + 1
let year = date.getFullYear()
const fecha_ingreso = day + '-'+ month + '-'+year;


 var reparar_pdf = ``;
 var cambiar_pdf = ``;
 var total_chapa = 0;
 var total_pintura = 0;
 var total_mecanica = 0;
 var total_repuesto = 0;
 var total_varios = 0;
 if (req.body.pieza_reparar!=null && req.body.pieza_reparar.length>0){
   if (typeof req.body.pieza_reparar == 'string'){
    reparar_pdf = reparar_pdf + `<tr>
    <td>`+req.body.pieza_reparar+`</td>
    <td style='border-left: 1px solid gray;text-align:center'>`+req.body.chapa_reparar+`</td>
    <td style='border-left: 1px solid gray;text-align:center'>`+req.body.pintura_reparar+`</td>
    <td style='border-left: 1px solid gray;text-align:center'>`+req.body.mecanica_reparar+`</td>
    <td style='border-left: 1px solid gray;text-align:center'>`+req.body.repuesto_reparar+`</td></tr>`
    total_chapa = total_chapa + Number(req.body.chapa_reparar);
    total_pintura = total_pintura + Number(req.body.pintura_reparar);
    total_mecanica = total_mecanica + Number(req.body.mecanica_reparar);
    total_varios = total_varios + Number(req.body.repuesto_reparar);

   } else if (req.body.pieza_reparar.length>1){
  for (i=0; i<req.body.pieza_reparar.length; i++){
    reparar_pdf = reparar_pdf + `<tr>
    <td>`+req.body.pieza_reparar[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+chapa_reparar_sql[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+pintura_reparar_sql[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_reparar_sql[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_reparar_sql[i]+`</td></tr>`
  total_chapa = total_chapa + Number(chapa_reparar_sql[i]);
  total_pintura = total_pintura + Number(pintura_reparar_sql[i]);
  total_mecanica = total_mecanica + Number(mecanica_reparar_sql[i]);
  total_varios = total_varios + Number(repuesto_reparar_sql[i]);
  }
}}
if (req.body.pieza_cambiar!=null && req.body.pieza_cambiar.length>0){
if (typeof req.body.pieza_cambiar == 'string'){
  var cambiar_pdf = cambiar_pdf + `<tr>
  <td>`+req.body.pieza_cambiar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.chapa_cambiar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.pintura_cambiar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.mecanica_cambiar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.repuesto_cambiar+`</td></tr>`
  total_chapa = total_chapa + Number(req.body.chapa_cambiar);
  total_pintura = total_pintura + Number(req.body.pintura_cambiar);
  total_mecanica = total_mecanica + Number(req.body.mecanica_cambiar);
total_repuesto = total_repuesto + Number(req.body.repuesto_cambiar);

} else {
for (j=0; j<req.body.pieza_cambiar.length; j++){
  var cambiar_pdf = cambiar_pdf + `<tr>
  <td>`+req.body.pieza_cambiar[j]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+chapa_cambiar_sql[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+pintura_cambiar_sql[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+mecanica_cambiar_sql[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+repuesto_cambiar_sql[j]+`</td></tr>`
total_chapa = total_chapa + Number(chapa_cambiar_sql[j]);
total_pintura = total_pintura + Number(pintura_cambiar_sql[j]);
total_mecanica = total_mecanica + Number(mecanica_cambiar_sql[j]);
total_repuesto = total_repuesto + Number(repuesto_cambiar_sql[j]);
}}
}
 if (total_chapa == 0){
   total_chapa = ''
  var ars_chapa=''
 } else {
   var ars_chapa = Math.trunc(Number(total_chapa) * Number(config[0].chapa_dia));
  }

  if (total_pintura == 0){
    total_pintura=''
    var ars_pintura=''
   } else {
    var ars_pintura = Math.trunc(Number(total_pintura) * Number(config[0].pintura_pano));
  }

    if (total_mecanica == 0){
      total_mecanica=''
      var ars_mecanica=''
     } else {
      var ars_mecanica = Math.trunc(Number(total_mecanica) * Number(config[0].mecanica_hora));
    }
    if (total_repuesto == 0){
      total_repuesto=''
    }
    if (total_varios == 0){
      total_varios=''
    }
    var total_mano = Math.trunc(Number(ars_chapa)+Number(ars_pintura)+Number(ars_mecanica)+Number(total_varios));
    if (total_mano == 0){
      total_mano=''
    }
var total_presupuesto_pdf = Number(total_repuesto) + Number(total_mano);
    await pool.query("UPDATE presupuestos SET nombre = ?, compania = ?, siniestro = ?, telefono = ?, modelo = ?, color = ?, pieza_reparar= ?, chapa_reparar = ?, pintura_reparar = ?, mecanica_reparar = ?, repuesto_reparar = ?, pieza_cambiar = ?, chapa_cambiar = ?, pintura_cambiar = ?, mecanica_cambiar = ?, repuesto_cambiar= ?, total_presupuesto = ?, franquicia = ?, fecha_ingreso = ?, particular = ? WHERE dominio = ? AND ruta_pdf = ?", [nombre, compania, siniestro, telefono,modelo,color, pieza_reparar, chapa_reparar, pintura_reparar, mecanica_reparar,repuesto_reparar, pieza_cambiar,chapa_cambiar,pintura_cambiar,mecanica_cambiar,repuesto_cambiar,total_presupuesto_pdf,franquicia,fecha_ingreso_nueva, particular, dominio, nombre_presupuesto]);
const pdf = require('html-pdf');

  const pdf1 = `
  <!doctype html>

  <html>
     <head>
          <meta charset="utf-8">
       <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

          <title>`+nombre_presupuesto+`</title>

          <style>
          * {
               font-family: Arial, Helvetica, sans-serif;
           }
           html, body {
               margin: 0;
               padding: 0;

             }

       </style>
   </head>
   <body>
   <div id="pageHeader" style="height:120px; margin-left: 10px;margin-right: 10px; margin-top:10px">
    <div style="border: groove;border-radius:10px; height:110px;">
   <img src="`+logosrc+`" alt="Taller Del Lago" height="100px" style="padding-left: 70px;padding-top:5px"/>
       <div style="padding-right: 10%;text-align:center;float: right;;margin-top:5px">
         <h3 style="margin-bottom: 1px"><b>Taller de Chapa y Pintura<b></h3>
         <blockquote style="font-size:x-small;margin: 1px">Direccin: Anasagasti 1383<br/>
     <i class="far fa-envelope"></i> tallerdellagobrc@gmail.com</br>
     <i class="fab fa-whatsapp"></i> +54 9 294 453-9715</blockquote>
     <br />
       </div>
   </div>
 </div>

  <div style="border: groove; ;border-radius:10px; padding: 5px;margin-left: 10px;margin-right: 10px" >
              <div style="padding-bottom: 5px; padding-top: 5px">
          <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
          <br />
          <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
    <tr style="border-bottom: 1px solid gray; background-color: lightgray">
      <th>DATOS DEL CLIENTE</th>
      <th style="border-left: 1px solid gray">DATOS DEL VEHCULO</th>
    </tr>
    <tr >
      <td style="padding-right: 20%;">Nombre: <span style="float:right">`+nombre+`</span></td>
      <td style="border-left: 1px solid gray;padding-right: 20%;">Marca: <span style="float:right">`+marca+`</span></td>
    </tr>
    <tr>
      <td style="padding-right: 20%;">Compaa: <span style="float:right">`+compania+`</span></td>
      <td style="border-left: 1px solid gray;padding-right: 20%;">Modelo: <span style="float:right">`+modelo+`</span></td>
    </tr>
    <tr>
    <td style="padding-right: 20%;">Siniestro: <span style="float:right">`+siniestro+`</span></td>
    <td style="border-left: 1px solid gray;padding-right: 20%;">Dominio: <span style="float:right">`+dominio+`</span></td>
  </tr>
  <tr>
  <td style="padding-right: 20%;">Telfono: <span style="float:right">`+telefono+`</span></td>
  <td style="border-left: 1px solid gray;padding-right: 20%;">Color: <span style="float:right">`+color+`</span></td>
  </tr>
  </table>

            </div></div>
              <div style="padding-bottom: 5px">
              <h6 style="margin-top:10px;margin-bottom:5px">A REPARAR</h6>
              <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
              <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
        <tr style="border-bottom: 1px solid gray; background-color: lightgray;width: 320px">
          <th style="width:170px">Descripcin</th>
          <th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
          <th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
          <th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
          <th style="border-left: 1px solid gray; width: 100px">Varios <small>($)</small></th>

        </tr>
       `+reparar_pdf+`
      </table>

                </div></div>
  <div style="padding-bottom: 5px">
  <h6 style="margin-top:10px;margin-bottom:5px">A CAMBIAR</h6>
  <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
  <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
<tr style="border-bottom: 1px solid gray; background-color: lightgray"; width: 320px>
<th style="width:170px">Descripcin</th>
<th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Repuestos <small>($)</small></th>

</tr>
`+cambiar_pdf+`
</table>

    </div></div>
    <div style="padding-bottom: 5px">
    <h6 style="margin-top:10px;margin-bottom:5px">TOTALES</h6>
    <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
    <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
<tr style="border-bottom: 1px solid gray; background-color: lightgray">
<th>Descripcin</th>
<th style="border-left: 1px solid gray">Cantidad</th>
<th style="border-left: 1px solid gray">Total <small>($)</small></th>

</tr>
<tr >
<td>Chapa <small>(da)</small></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_chapa+`</td>
<td style="border-left: 1px solid gray;text-align:center">`+ars_chapa+`</td>
</tr>
<tr >
<td>Pintura <small>(pao)</small></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_pintura+`</td>
<td style="border-left: 1px solid gray;text-align:center">`+ars_pintura+`</td>
</tr>
<tr >
<td >Mecnica <small>(hora)</small></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_mecanica+`</td>
<td style="border-left: 1px solid gray;text-align:center">`+ars_mecanica+`</td>
</tr>
<tr >
<td >Varios <small>($)</small></td>
<td style="border-left: 1px solid gray;text-align:center"></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_varios+`</td>
</tr>
<tr style="border-bottom: 1px solid gray; border-top: 1px solid gray; background-color: lightgray">
<td >Total mano de obra <small>($)</small> </td>
<td></td>
<td style="text-align:center">`+total_mano+`</td>
</tr>
<tr >
<td >Repuestos <small>($)</small></td>
<td style="border-left: 1px solid gray;text-align:center"></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_repuesto+`</td>
</tr>
</table>

      </div></div>   <p style="font-size: 0.65rem">  <span style="float:left">PRESUPUESTO N: `+n_presupuesto+`</span> <span style="float:right">TOTAL: $`+total_presupuesto_pdf+`.-

      `;

   if (franquicia != '' && franquicia != null){
     var pdf2 = `<br />FRANQUICIA: $`+franquicia+`.-</span></p>

     <br/><br/><br/>
   <p style="font-size:xx-small">Fecha `+fecha_ingreso+`</p>
   <p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

   </body>
   </html>`;
   } else if (franquicia == '' || franquicia == null) {
     var pdf2 =  `</span></p>
     <br/><br/><br/>
   <p style="font-size:xx-small">Fecha `+fecha_ingreso+`</p>
   <p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

   </body>
   </html>`;
   }

const contentpdf = pdf1 + pdf2;
pdf.create(contentpdf).toStream((err, stream) => {
if (err) return res.end(err.stack)
res.setHeader('Content-type', 'application/pdf')
res.setHeader('Content-Disposition', 'attachment; filename='+nombre_presupuesto+'.pdf')
stream.pipe(res)


})


});

router.post('/nuevopresupuesto',isLoggedIn, async (req, res) => {
  var chapa_reparar_sql = [];
  var pintura_reparar_sql = [];
  var mecanica_reparar_sql = [];
  var repuesto_reparar_sql = [];
  var chapa_cambiar_sql = [];
  var pintura_cambiar_sql = [];
  var mecanica_cambiar_sql = [];
  var repuesto_cambiar_sql = [];

if (req.body.pieza_reparar != undefined){
    if (typeof req.body.pieza_reparar != 'string'){

  for (i=0;i<req.body.pieza_reparar.length;i++){
    if (req.body.chapa_reparar[i] != '') {
      chapa_reparar_sql.push(req.body.chapa_reparar[i])
    } else if (req.body.chapa_reparar[i] == ''){
      chapa_reparar_sql.push(' ')
    }
    if (req.body.pintura_reparar[i] != '') {
      pintura_reparar_sql.push(req.body.pintura_reparar[i])
    } else if (req.body.pintura_reparar[i] == ''){
      pintura_reparar_sql.push(' ')
    }
    if (req.body.mecanica_reparar[i] != '') {
      mecanica_reparar_sql.push(req.body.mecanica_reparar[i])
    } else if (req.body.mecanica_reparar[i] == ''){
      mecanica_reparar_sql.push(' ')
    }
    if (req.body.repuesto_reparar[i] != '') {
      repuesto_reparar_sql.push(req.body.repuesto_reparar[i])
    } else if (req.body.repuesto_reparar[i] == ''){
      repuesto_reparar_sql.push(' ')
    }

  }
 } else {
    if (req.body.chapa_reparar != '') {
      chapa_reparar_sql.push(req.body.chapa_reparar)
    } else if (req.body.chapa_reparar == ''){
      chapa_reparar_sql.push(' ')
    }
    if (req.body.pintura_reparar != '') {
      pintura_reparar_sql.push(req.body.pintura_reparar)
    } else if (req.body.pintura_reparar == ''){
      pintura_reparar_sql.push(' ')
    }
    if (req.body.mecanica_reparar != '') {
      mecanica_reparar_sql.push(req.body.mecanica_reparar)
    } else if (req.body.mecanica_reparar == ''){
      mecanica_reparar_sql.push(' ')
    }
    if (req.body.repuesto_reparar != '') {
      repuesto_reparar_sql.push(req.body.repuesto_reparar)
    } else if (req.body.repuesto_reparar == ''){
      repuesto_reparar_sql.push(' ')
    }
  }
}
if (req.body.pieza_cambiar != undefined){
    if (typeof req.body.pieza_cambiar != 'string'){

for (j=0;j<req.body.pieza_cambiar.length;j++){
  if (req.body.chapa_cambiar[j] != '') {
    chapa_cambiar_sql.push(req.body.chapa_cambiar[j])
  } else if (req.body.chapa_cambiar[j] == ''){
    chapa_cambiar_sql.push(' ')
  }
  if (req.body.pintura_cambiar[j] != '') {
    pintura_cambiar_sql.push(req.body.pintura_cambiar[j])
  } else if (req.body.pintura_cambiar[j] == ''){
    pintura_cambiar_sql.push(' ')
  }
  if (req.body.mecanica_cambiar[j] != '') {
    mecanica_cambiar_sql.push(req.body.mecanica_cambiar[j])
  } else if (req.body.mecanica_cambiar[j] == ''){
    mecanica_cambiar_sql.push(' ')
  }
  if (req.body.repuesto_cambiar[j] != '') {
    repuesto_cambiar_sql.push(req.body.repuesto_cambiar[j])
  } else if (req.body.repuesto_cambiar[j] == ''){
    repuesto_cambiar_sql.push(' ')
  }
}
} else {
      if (req.body.chapa_cambiar != '') {
        chapa_cambiar_sql.push(req.body.chapa_cambiar)
      } else if (req.body.chapa_cambiar == ''){
        chapa_cambiar_sql.push(' ')
      }
      if (req.body.pintura_cambiar != '') {
        pintura_cambiar_sql.push(req.body.pintura_cambiar)
      } else if (req.body.pintura_cambiar == ''){
        pintura_cambiar_sql.push(' ')
      }
      if (req.body.mecanica_cambiar != '') {
        mecanica_cambiar_sql.push(req.body.mecanica_cambiar)
      } else if (req.body.mecanica_cambiar == ''){
        mecanica_cambiar_sql.push(' ')
      }
      if (req.body.repuesto_cambiar != '') {
        repuesto_cambiar_sql.push(req.body.repuesto_cambiar)
      } else if (req.body.repuesto_cambiar == ''){
        repuesto_cambiar_sql.push(' ')
      }
    }
}
const chapa_reparar = JSON.stringify(chapa_reparar_sql)
const pieza_reparar = JSON.stringify(req.body.pieza_reparar)
const pintura_reparar = JSON.stringify(pintura_reparar_sql)
const mecanica_reparar = JSON.stringify(mecanica_reparar_sql)
const repuesto_reparar = JSON.stringify(repuesto_reparar_sql)
const pieza_cambiar = JSON.stringify(req.body.pieza_cambiar)
const chapa_cambiar = JSON.stringify(chapa_cambiar_sql)
const pintura_cambiar = JSON.stringify(pintura_cambiar_sql)
const mecanica_cambiar = JSON.stringify(mecanica_cambiar_sql)
const repuesto_cambiar = JSON.stringify(repuesto_cambiar_sql)
const { nombre,
    
     telefono,
     marca,
     modelo,
     dominio,
     color,
     total_presupuesto,
     franquicia,
     observacion,
     particular
} = req.body;
if (particular == 1){
var compania = 'Particular'
var siniestro = ''

} else {
var compania = req.body.compania;
var siniestro = req.body.siniestro;
}
const verpresupuestos = await pool.query('SELECT id FROM presupuestos WHERE dominio = ?', [dominio]);
const config = await pool.query('SELECT * FROM configuracion');
if (verpresupuestos.length>0){
var primerpresupuesto = String(verpresupuestos[0].id)
if (verpresupuestos.length == 1){
  var num_presupuesto = 'A';
  var numero_pres = 2;
  var n_presupuesto = primerpresupuesto+num_presupuesto
} else if (verpresupuestos.length == 2){
  var num_presupuesto = 'B';
  var numero_pres = 3;
  var n_presupuesto = primerpresupuesto+num_presupuesto
}else if (verpresupuestos.length == 3){
  var num_presupuesto = 'C';
  var n_presupuesto = primerpresupuesto+num_presupuesto
  var numero_pres = 4;
}else if (verpresupuestos.length == 4){
var num_presupuesto = 'D';
var n_presupuesto = primerpresupuesto+num_presupuesto
var numero_pres = 5;
}else if (verpresupuestos.length == 5){
var num_presupuesto = 'E';
var n_presupuesto = primerpresupuesto+num_presupuesto
var numero_pres = 6;
}

} else if (verpresupuestos.length==0) {
var numero_pres = 1;
var ult_pres = await pool.query('SELECT n_presupuesto FROM num_presupuestos ORDER BY n_presupuesto DESC LIMIT 1');
if (ult_pres.length == 0){
var n_presupuesto = 1;
} else {
var n_presupuesto = Number(ult_pres[0].n_presupuesto +1);
}
await pool.query('INSERT INTO num_presupuestos SET dominio = ?',[dominio]);
}




var reparar_pdf = ``;
var cambiar_pdf = ``;
var total_chapa = 0;
var total_pintura = 0;
var total_mecanica = 0;
var total_repuesto = 0;
var total_varios = 0;

if (req.body.pieza_reparar!=null && req.body.pieza_reparar.length>0){
 if (typeof req.body.pieza_reparar == 'string'){
  reparar_pdf = reparar_pdf + `<tr>
  <td>`+req.body.pieza_reparar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.chapa_reparar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.pintura_reparar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.mecanica_reparar+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+req.body.repuesto_reparar+`</td></tr>`
  total_chapa = total_chapa + Number(req.body.chapa_reparar);
  total_pintura = total_pintura + Number(req.body.pintura_reparar);
  total_mecanica = total_mecanica + Number(req.body.mecanica_reparar);
  total_varios = total_varios + Number(req.body.repuesto_reparar);

 } else if (req.body.pieza_reparar.length>1){
for (i=0; i<req.body.pieza_reparar.length; i++){
  reparar_pdf = reparar_pdf + `<tr>
  <td>`+req.body.pieza_reparar[i]+`</td>
    <td style='border-left: 1px solid gray;text-align:center'>`+chapa_reparar_sql[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+pintura_reparar_sql[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_reparar_sql[i]+`</td>
  <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_reparar_sql[i]+`</td></tr>`
  total_chapa = total_chapa + Number(chapa_reparar_sql[i]);
  total_pintura = total_pintura + Number(pintura_reparar_sql[i]);
  total_mecanica = total_mecanica + Number(mecanica_reparar_sql[i]);
  total_varios = total_varios + Number(repuesto_reparar_sql[i]);
}
}}
if (req.body.pieza_cambiar!=null && req.body.pieza_cambiar.length>0){
if (typeof req.body.pieza_cambiar == 'string'){
var cambiar_pdf = cambiar_pdf + `<tr>
<td>`+req.body.pieza_cambiar+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+req.body.chapa_cambiar+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+req.body.pintura_cambiar+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+req.body.mecanica_cambiar+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+req.body.repuesto_cambiar+`</td></tr>`
total_chapa = total_chapa + Number(req.body.chapa_cambiar);
total_pintura = total_pintura + Number(req.body.pintura_cambiar);
total_mecanica = total_mecanica + Number(req.body.mecanica_cambiar);
total_repuesto = total_repuesto + Number(req.body.repuesto_cambiar);
} else {
for (j=0; j<req.body.pieza_cambiar.length; j++){
var cambiar_pdf = cambiar_pdf + `<tr>
<td>`+req.body.pieza_cambiar[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+chapa_cambiar_sql[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+pintura_cambiar_sql[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+mecanica_cambiar_sql[j]+`</td>
<td style='border-left: 1px solid gray;text-align:center'>`+repuesto_cambiar_sql[j]+`</td></tr>`
total_chapa = total_chapa + Number(chapa_cambiar_sql[j]);
total_pintura = total_pintura + Number(pintura_cambiar_sql[j]);
total_mecanica = total_mecanica + Number(mecanica_cambiar_sql[j]);
total_repuesto = total_repuesto + Number(repuesto_cambiar_sql[j]);
}
}
}
if (total_chapa == 0){
 total_chapa = ''
var ars_chapa=''
} else {
 var ars_chapa = Math.trunc(Number(total_chapa) * Number(config[0].chapa_dia));
}

if (total_pintura == 0){
  total_pintura=''
  var ars_pintura=''
 } else {
  var ars_pintura = Math.trunc(Number(total_pintura) * Number(config[0].pintura_pano));
}

  if (total_mecanica == 0){
    total_mecanica=''
    var ars_mecanica=''
   } else {
    var ars_mecanica = Math.trunc(Number(total_mecanica) * Number(config[0].mecanica_hora));
  }
  if (total_repuesto == 0){
    total_repuesto=''
  }
  if (total_varios == 0){
    total_varios=''
  }
  var total_mano = Math.trunc(Number(ars_chapa)+Number(ars_pintura)+Number(ars_mecanica)+Number(total_varios));
  if (total_mano == 0){
    total_mano=''
  }

  const total_presupuesto_ars = total_mano + total_repuesto;

  const nuevoPresupuesto = {
    nombre,
    n_presupuesto,
    compania: compania,
    siniestro,
    telefono,
    marca,
    modelo,
    dominio,
    color,
    pieza_reparar,
    chapa_reparar,
    pintura_reparar,
    mecanica_reparar,
    repuesto_reparar,
    pieza_cambiar,
    chapa_cambiar,
    pintura_cambiar,
    mecanica_cambiar,
    repuesto_cambiar,
    total_presupuesto: total_presupuesto_ars,
    franquicia: franquicia || null,
    fecha_ingreso: new Date().toISOString().slice(0, 19).replace('T', ' '),
    numero_pres,
    turno: 0,
    particular,
    estado: 'Presupuestada',
    valor_chapa: config[0].chapa_dia,
    valor_pintura: config[0].pintura_pano,
    valor_mecanica: config[0].mecanica_hora
};

let date = new Date()

let day = date.getDate()
let month = date.getMonth() + 1
let year = date.getFullYear()
const fecha_ingreso = day + '-'+ month + '-'+year

 await pool.query('INSERT INTO presupuestos set ?', [nuevoPresupuesto]);

const pdf = require('html-pdf');

const ruta_pdf = '../taller/src/public/pdf/presupuestos/'+dominio+'/'+n_presupuesto+ '-' +dominio+'.pdf';
const pdf1 = `
<!doctype html>

<html>
   <head>
        <meta charset="utf-8">
     <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

        <title>`+n_presupuesto+`- `+dominio+`</title>

        <style>
        * {
             font-family: Arial, Helvetica, sans-serif;
         }
         html, body {
             margin: 0;
             padding: 0;

           }

     </style>
 </head>
 <body>
 <div id="pageHeader" style="height:120px; margin-left: 10px;margin-right: 10px; margin-top:10px">
  <div style="border: groove;border-radius:10px; height:110px;">
 <img src="`+logosrc+`" alt="Taller Del Lago" height="100px" style="padding-left: 70px;padding-top:5px"/>
     <div style="padding-right: 10%;text-align:center;float: right;;margin-top:5px">
       <h3 style="margin-bottom: 1px"><b>Taller de Chapa y Pintura<b></h3>
       <blockquote style="font-size:x-small;margin: 1px">Direccin: Anasagasti 1383<br/>
   <i class="far fa-envelope"></i> tallerdellagobrc@gmail.com</br>
   <i class="fab fa-whatsapp"></i> +54 9 294 453-9715</blockquote>
   <br />
     </div>
 </div>
</div>

<div style="border: groove; ;border-radius:10px; padding: 5px;margin-left: 10px;margin-right: 10px" >
            <div style="padding-bottom: 5px; padding-top: 5px">
        <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
        <br />
        <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
  <tr style="border-bottom: 1px solid gray; background-color: lightgray">
    <th>DATOS DEL CLIENTE</th>
    <th style="border-left: 1px solid gray">DATOS DEL VEHCULO</th>
  </tr>
  <tr >
    <td style="padding-right: 20%;">Nombre: <span style="float:right">`+nombre+`</span></td>
    <td style="border-left: 1px solid gray;padding-right: 20%;">Marca: <span style="float:right">`+marca+`</span></td>
  </tr>
  <tr>
    <td style="padding-right: 20%;">Compaa: <span style="float:right">`+compania+`</span></td>
    <td style="border-left: 1px solid gray;padding-right: 20%;">Modelo: <span style="float:right">`+modelo+`</span></td>
  </tr>
  <tr>
  <td style="padding-right: 20%;">Siniestro: <span style="float:right">`+siniestro+`</span></td>
  <td style="border-left: 1px solid gray;padding-right: 20%;">Dominio: <span style="float:right">`+dominio+`</span></td>
</tr>
<tr>
<td style="padding-right: 20%;">Telfono: <span style="float:right">`+telefono+`</span></td>
<td style="border-left: 1px solid gray;padding-right: 20%;">Color: <span style="float:right">`+color+`</span></td>
</tr>
</table>

          </div></div>
            <div style="padding-bottom: 5px">
            <h6 style="margin-top:10px;margin-bottom:5px">A REPARAR</h6>
            <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
            <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
      <tr style="border-bottom: 1px solid gray; background-color: lightgray;width: 320px">
        <th style="width:170px">Descripcin</th>
        <th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
        <th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
        <th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
        <th style="border-left: 1px solid gray; width: 100px">Varios <small>($)</small></th>

      </tr>
     `+reparar_pdf+`
    </table>

              </div></div>
<div style="padding-bottom: 5px">
<h6 style="margin-top:10px;margin-bottom:5px">A CAMBIAR</h6>
<div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
<table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
<tr style="border-bottom: 1px solid gray; background-color: lightgray"; width: 320px>
<th style="width:170px">Descripcin</th>
<th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Repuestos <small>($)</small></th>

</tr>
`+cambiar_pdf+`
</table>

  </div></div>
  <div style="padding-bottom: 5px">
  <h6 style="margin-top:10px;margin-bottom:5px">TOTALES</h6>
  <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
  <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
<tr style="border-bottom: 1px solid gray; background-color: lightgray">
<th>Descripcin</th>
<th style="border-left: 1px solid gray">Cantidad</th>
<th style="border-left: 1px solid gray">Total <small>($)</small></th>

</tr>
<tr >
<td>Chapa <small>(da)</small></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_chapa+`</td>
<td style="border-left: 1px solid gray;text-align:center">`+ars_chapa+`</td>
</tr>
<tr >
<td>Pintura <small>(pao)</small></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_pintura+`</td>
<td style="border-left: 1px solid gray;text-align:center">`+ars_pintura+`</td>
</tr>
<tr >
<td >Mecnica <small>(hora)</small></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_mecanica+`</td>
<td style="border-left: 1px solid gray;text-align:center">`+ars_mecanica+`</td>
</tr>
<tr >
<td >Varios <small>($)</small></td>
<td style="border-left: 1px solid gray;text-align:center"></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_varios+`</td>
</tr>
<tr style="border-bottom: 1px solid gray; border-top: 1px solid gray; background-color: lightgray">
<td >Total mano de obra <small>($)</small> </td>
<td></td>
<td style="text-align:center">`+total_mano+`</td>
</tr>
<tr >
<td >Repuestos <small>($)</small></td>
<td style="border-left: 1px solid gray;text-align:center"></td>
<td style="border-left: 1px solid gray;text-align:center">`+total_repuesto+`</td>
</tr>
</table>

    </div></div>   <p style="font-size: 0.65rem">  <span style="float:left">PRESUPUESTO N: `+n_presupuesto+`</span> <span style="float:right">TOTAL: $`+total_presupuesto_ars+`.-

    `;

 if (franquicia != '' && franquicia != null){
   var pdf2 = `<br />FRANQUICIA: $`+franquicia+`.-</span></p>

   <br/><br/><br/>
 <p style="font-size:xx-small">Fecha `+fecha_ingreso+`</p>
 <p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

 </body>
 </html>`;
 } else if (franquicia == '' || franquicia == null) {
   var pdf2 =  `</span></p>
   <br/><br/><br/>
 <p style="font-size:xx-small">Fecha `+fecha_ingreso+`</p>
 <p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

 </body>
 </html>`;
 }

const contentpdf = pdf1 + pdf2;





/*
pdf.create(contentpdf).toFile(ruta_pdf, function(err, res) {
    if (err){
        console.log(err);
    } else {
        console.log(res);
    }
});
*/
const ruta_pdf_absol = String(fecha_ingreso+ '-' +dominio+ '-' +n_presupuesto);

   await pool.query('UPDATE presupuestos set ruta_pdf = ? WHERE n_presupuesto = ? AND dominio = ?', [ruta_pdf_absol, n_presupuesto, dominio]);
    const pdfcargados = await pool.query('SELECT *  FROM ordenes WHERE dominio = ?', [dominio]);
    if (pdfcargados.length==0){
      if (particular == 1){
        var nuevoregistro = {
          nombre, dominio, estado: 'Presupuestada', turno_particular: 1, observacion_0: observacion || null, presupuesto_0: ruta_pdf_absol
        }
      } else {
        var nuevoregistro = {
          nombre, dominio, estado: 'Presupuestada', observacion_0: observacion || null, presupuesto_0: ruta_pdf_absol
        }
      }

      await pool.query('INSERT INTO ordenes set ?', [nuevoregistro]);
    } else {
     if (pdfcargados[0].presupuesto_A == null){
      await pool.query('UPDATE ordenes set presupuesto_A =?, observacion_A = ? WHERE dominio = ?', [ruta_pdf_absol, observacion || null, dominio]);
     } else if (pdfcargados[0].presupuesto_B == null){
      await pool.query('UPDATE ordenes set presupuesto_B =?, observacion_B = ? WHERE dominio = ?', [ruta_pdf_absol, observacion || null,dominio]);
     }else if (pdfcargados[0].presupuesto_C == null){
      await pool.query('UPDATE ordenes set presupuesto_C =?, observacion_C = ? WHERE dominio = ?', [ruta_pdf_absol, observacion || null,dominio]);
     }else if (pdfcargados[0].presupuesto_D == null){
      await pool.query('UPDATE ordenes set presupuesto_D =?, observacion_D = ? WHERE dominio = ?', [ruta_pdf_absol, observacion || null,dominio]);
     }else if (pdfcargados[0].presupuesto_E == null){
      await pool.query('UPDATE ordenes set presupuesto_E =?, observacion_E = ? WHERE dominio = ?', [ruta_pdf_absol, observacion || null,dominio]);
     }

    }

    pdf.create(contentpdf).toStream((err, stream) => {
      if (err) return res.end(err.stack)
  res.setHeader('Content-type', 'application/pdf')
  res.setHeader('Content-Disposition', 'attachment; filename='+ruta_pdf_absol+'.pdf')
  stream.pipe(res)



})

});



router.get('/:dominio/:ruta_pdf/presupuestos.json', isLoggedIn, async (req, res, next) =>{
  const {dominio,ruta_pdf} = req.params;
  const presupuestos = await pool.query('SELECT `n_presupuesto`, `pieza_reparar`, `chapa_reparar`, `pintura_reparar`, `mecanica_reparar`, `repuesto_reparar`, `pieza_cambiar`, `chapa_cambiar`, `pintura_cambiar`, `mecanica_cambiar`, `repuesto_cambiar`, `total_presupuesto`, `n_presupuesto` FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, ruta_pdf]);




  if (presupuestos[0].pieza_reparar == null){
    if (presupuestos[0].pieza_cambiar != null){
      var presupuestos_ok = {
        pieza_cambiar: Array(presupuestos[0].pieza_cambiar),
        chapa_cambiar: Array(presupuestos[0].chapa_cambiar),
        pintura_cambiar: Array(presupuestos[0].pintura_cambiar),
        mecanica_cambiar: Array(presupuestos[0].mecanica_cambiar),
        repuesto_cambiar: Array(presupuestos[0].repuesto_cambiar),
        total_presupuesto: presupuestos[0].total_presupuesto,
        n_presupuesto: presupuestos[0].n_presupuesto,
        ruta_pdf: ruta_pdf
      }
    }
  } else  if (presupuestos[0].pieza_cambiar == null){
    if (presupuestos[0].pieza_reparar != null){
      var presupuestos_ok = {
        pieza_reparar: Array(presupuestos[0].pieza_reparar),
        chapa_reparar: Array(presupuestos[0].chapa_reparar),
        pintura_reparar: Array(presupuestos[0].pintura_reparar),
        mecanica_reparar: Array(presupuestos[0].mecanica_reparar),
        repuesto_reparar: Array(presupuestos[0].repuesto_reparar),
        total_presupuesto: presupuestos[0].total_presupuesto,
        n_presupuesto: presupuestos[0].n_presupuesto,
        ruta_pdf: ruta_pdf

      }
    }
  } else if (presupuestos[0].pieza_cambiar == null && presupuestos[0].pieza_reparar == null){
    var presupuestos_ok = {}
  } else {
    var presupuestos_ok = {
      pieza_reparar: Array(presupuestos[0].pieza_reparar),
      chapa_reparar: Array(presupuestos[0].chapa_reparar),
      pintura_reparar: Array(presupuestos[0].pintura_reparar),
      mecanica_reparar: Array(presupuestos[0].mecanica_reparar),
      repuesto_reparar: Array(presupuestos[0].repuesto_reparar),
      pieza_cambiar: Array(presupuestos[0].pieza_cambiar),
      chapa_cambiar: Array(presupuestos[0].chapa_cambiar),
      pintura_cambiar: Array(presupuestos[0].pintura_cambiar),
      mecanica_cambiar: Array(presupuestos[0].mecanica_cambiar),
      repuesto_cambiar: Array(presupuestos[0].repuesto_cambiar),
      total_presupuesto: presupuestos[0].total_presupuesto,
      n_presupuesto: presupuestos[0].n_presupuesto,
      ruta_pdf: ruta_pdf
    }
  }

  res.send(presupuestos_ok)
});




router.get('/pdfpresupuestomob/:dominio/:rutapdf', isLoggedIn, async (req, res) => {
  const { dominio, rutapdf} = req.params;
        const config = await pool.query('SELECT * FROM configuracion');
  const presupuesto = await pool.query('SELECT *, DATE_FORMAT(fecha_ingreso, "%d/%m/%y") AS fecha_ingreso FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, rutapdf]);

var pieza_reparar = JSON.parse(presupuesto[0].pieza_reparar);
var chapa_reparar = JSON.parse(presupuesto[0].chapa_reparar);
var pintura_reparar = JSON.parse(presupuesto[0].pintura_reparar);
var repuesto_reparar = JSON.parse(presupuesto[0].repuesto_reparar);
var mecanica_reparar = JSON.parse(presupuesto[0].mecanica_reparar);
var pieza_cambiar = JSON.parse(presupuesto[0].pieza_cambiar);
var chapa_cambiar = JSON.parse(presupuesto[0].chapa_cambiar);
var pintura_cambiar = JSON.parse(presupuesto[0].pintura_cambiar);
var mecanica_cambiar = JSON.parse(presupuesto[0].mecanica_cambiar);
var repuesto_cambiar = JSON.parse(presupuesto[0].repuesto_cambiar);

  var reparar_pdf = ``;
  var cambiar_pdf = ``;
  var total_chapa = 0;
  var total_pintura = 0;
  var total_mecanica = 0;
  var total_repuesto = 0;
  var total_varios = 0;
  if (pieza_reparar!=null && pieza_reparar.length>0){
    if (typeof pieza_reparar == 'string'){
     reparar_pdf = reparar_pdf + `<tr>
     <td>`+pieza_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+chapa_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+pintura_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_reparar+`</td></tr>`
     total_chapa = total_chapa + Number(chapa_reparar);
     total_pintura = total_pintura + Number(pintura_reparar);
     total_mecanica = total_mecanica + Number(mecanica_reparar);
     total_varios = total_varios + Number(repuesto_reparar);

    } else if (pieza_reparar.length>1){
   for (i=0; i<pieza_reparar.length; i++){
     reparar_pdf = reparar_pdf + `<tr>
     <td>`+pieza_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+chapa_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+pintura_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_reparar[i]+`</td></tr>`
     total_chapa = total_chapa + Number(chapa_reparar[i]);
     total_pintura = total_pintura + Number(pintura_reparar[i]);
     total_mecanica = total_mecanica + Number(mecanica_reparar[i]);
     total_varios = total_varios + Number(repuesto_reparar[i]);
   }
}}
if (pieza_cambiar!=null && pieza_cambiar.length>0){
 if (typeof pieza_cambiar == 'string'){
   var cambiar_pdf = cambiar_pdf + `<tr>
   <td>`+pieza_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+chapa_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+pintura_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_cambiar+`</td></tr>`
   total_chapa = total_chapa + Number(chapa_cambiar);
   total_pintura = total_pintura + Number(pintura_cambiar);
   total_mecanica = total_mecanica + Number(mecanica_cambiar);
   total_repuesto = total_repuesto + Number(repuesto_cambiar);
 } else {
 for (j=0; j<pieza_cambiar.length; j++){
   var cambiar_pdf = cambiar_pdf + `<tr>
   <td>`+pieza_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+chapa_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+pintura_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_cambiar[j]+`</td></tr>`
   total_chapa = total_chapa + Number(chapa_cambiar[j]);
   total_pintura = total_pintura + Number(pintura_cambiar[j]);
   total_mecanica = total_mecanica + Number(mecanica_cambiar[j]);
   total_repuesto = total_repuesto + Number(repuesto_cambiar[j]);
 }}
}
  if (total_chapa == 0){
    total_chapa = ''
   var ars_chapa=''
  } else {
    var ars_chapa = Math.trunc(Number(total_chapa) * Number(presupuesto[0].valor_chapa));
   }

   if (total_pintura == 0){
     total_pintura=''
     var ars_pintura=''
    } else {
     var ars_pintura = Math.trunc(Number(total_pintura) * Number(presupuesto[0].valor_pintura));
   }

     if (total_mecanica == 0){
       total_mecanica=''
       var ars_mecanica=''
      } else {
       var ars_mecanica = Math.trunc(Number(total_mecanica) * Number(presupuesto[0].valor_mecanica));
     }
     if (total_repuesto == 0){
       total_repuesto=''
     }
     if (total_varios == 0){
       total_varios=''
     }
     var total_mano = Math.trunc(Number(ars_chapa)+Number(ars_pintura)+Number(ars_mecanica)+Number(total_varios));
     if (total_mano == 0){
       total_mano=''
     }

     const total_presupuesto_ars = total_mano + total_repuesto;
const pdf = require('html-pdf');

   const pdf1 = `
   <!doctype html>

   <html>
      <head>
           <meta charset="utf-8">
        <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

           <title>`+rutapdf+`</title>

         <style>
              * {
                   font-family: Arial, Helvetica, sans-serif;
               }
               html, body {
                   margin: 0;
                   padding: 0;

                 }

           </style>
       </head>
       <body>
       <div id="pageHeader" style="height:120px; margin-left: 10px;margin-right: 10px; margin-top:10px; color: blue">
        <div style="border: groove;border-radius:10px; height:110px;">
       <img src="`+logosrc+`" alt="Taller Del Lago" height="100px" style="padding-left: 70px;padding-top:5px"/>
           <div style="padding-right: 10%;text-align:center;float: right;;margin-top:5px">
             <h3 style="margin-bottom: 1px"><b>Taller de Chapa y Pintura<b></h3>
             <blockquote style="font-size:x-small;margin: 1px">Direccin: Anasagasti 1383<br/>
         <i class="far fa-envelope"></i> tallerdellagobrc@gmail.com</br>
         <i class="fab fa-whatsapp"></i> +54 9 294 453-9715</blockquote>
         <br />
           </div>
       </div>
     </div>

  <div style="border: groove; ;border-radius:10px; padding: 5px; margin-left: 10px;margin-right: 10px; color: blue" >
               <div style="padding-bottom: 5px; padding-top: 5px">
           <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
           <br />
           <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
     <tr style="border-bottom: 1px solid gray; background-color: lightgray">
       <th>DATOS DEL CLIENTE</th>
       <th style="border-left: 1px solid gray">DATOS DEL VEHCULO</th>
     </tr>
     <tr >
       <td style="padding-right: 20%;">Nombre: <span style="float:right">`+presupuesto[0].nombre+`</span></td>
       <td style="border-left: 1px solid gray;padding-right: 20%;">Marca: <span style="float:right">`+presupuesto[0].marca+`</span></td>
     </tr>
     <tr>
       <td style="padding-right: 20%;">Compaa: <span style="float:right">`+presupuesto[0].compania+`</span></td>
       <td style="border-left: 1px solid gray;padding-right: 20%;">Modelo: <span style="float:right">`+presupuesto[0].modelo+`</span></td>
     </tr>
     <tr>
     <td style="padding-right: 20%;">Siniestro: <span style="float:right">`+presupuesto[0].siniestro+`</span></td>
     <td style="border-left: 1px solid gray;padding-right: 20%;">Dominio: <span style="float:right">`+presupuesto[0].dominio+`</span></td>
   </tr>
   <tr>
   <td style="padding-right: 20%;">Telfono: <span style="float:right">`+presupuesto[0].telefono+`</span></td>
   <td style="border-left: 1px solid gray;padding-right: 20%;">Color: <span style="float:right">`+presupuesto[0].color+`</span></td>
   </tr>
   </table>

             </div></div>
               <div style="padding-bottom: 5px">
               <h6 style="margin-top:10px;margin-bottom:5px">A REPARAR</h6>
               <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
               <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
         <tr style="border-bottom: 1px solid gray; background-color: lightgray;width: 320px">
           <th style="width:170px">Descripcin</th>
           <th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
           <th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
           <th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
           <th style="border-left: 1px solid gray; width: 100px">Varios <small>($)</small></th>

         </tr>
        `+reparar_pdf+`
       </table>

                 </div></div>
   <div style="padding-bottom: 5px" >
   <h6 style="margin-top:10px;margin-bottom:5px">A CAMBIAR</h6>
   <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
   <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
<tr style="border-bottom: 1px solid gray; background-color: lightgray"; width: 320px>
<th style="width:170px">Descripcin</th>
<th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Repuestos <small>($)</small></th>

</tr>
`+cambiar_pdf+`
</table>

     </div></div>
     <div style="padding-bottom: 5px">
     <h6 style="margin-top:10px;margin-bottom:5px">TOTALES</h6>
     <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
     <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
 <tr style="border-bottom: 1px solid gray; background-color: lightgray">
 <th>Descripcin</th>
 <th style="border-left: 1px solid gray">Cantidad</th>
 <th style="border-left: 1px solid gray">Total <small>($)</small></th>

 </tr>
 <tr >
 <td>Chapa <small>(da)</small></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_chapa+`</td>
 <td style="border-left: 1px solid gray;text-align:center">`+ars_chapa+`</td>
 </tr>
 <tr >
 <td>Pintura <small>(pao)</small></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_pintura+`</td>
 <td style="border-left: 1px solid gray;text-align:center">`+ars_pintura+`</td>
 </tr>
 <tr >
 <td >Mecnica <small>(hora)</small></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_mecanica+`</td>
 <td style="border-left: 1px solid gray;text-align:center">`+ars_mecanica+`</td>
 </tr>
 <tr >
 <td >Varios <small>($)</small></td>
 <td style="border-left: 1px solid gray;text-align:center"></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_varios+`</td>
 </tr>
 <tr style="border-bottom: 1px solid gray; border-top: 1px solid gray; background-color: lightgray">
 <td >Total mano de obra <small>($)</small> </td>
 <td></td>
 <td style="text-align:center">`+total_mano+`</td>
</tr>
 <tr >
 <td >Repuestos <small>($)</small></td>
 <td style="border-left: 1px solid gray;text-align:center"></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_repuesto+`</td>
 </tr>
 </table>

       </div></div>   <p style="font-size: 0.65rem">  <span style="float:left">PRESUPUESTO N: `+presupuesto[0].n_presupuesto+`</span> <span style="float:right">TOTAL: $`+total_presupuesto_ars+`.-

   `;

if (presupuesto[0].franquicia != '' && presupuesto[0].franquicia != null){
  var pdf2 = `<br />FRANQUICIA: $`+presupuesto[0].franquicia+`.-</span></p>

  <br/><br/><br/>
<p style="font-size:xx-small">Fecha `+presupuesto[0].fecha_ingreso+`</p>
<p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

</body>
</html>`;
} else if (presupuesto[0].franquicia == '' || presupuesto[0].franquicia == null) {
  var pdf2 =  `</span></p>
  <br/><br/><br/>
<p style="font-size:xx-small">Fecha `+presupuesto[0].fecha_ingreso+`</p>
<p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

</body>
</html>`;
}

const contentpdf = pdf1 + pdf2;
pdf.create(contentpdf).toStream((err, stream) => {
  if (err) return res.end(err.stack)
res.setHeader('Content-type', 'application/pdf')
res.setHeader('Content-Disposition', 'attachment; filename='+rutapdf+'.pdf')

stream.pipe(res)

})


});

router.get('/pdfpresupuesto/:dominio/:rutapdf', isLoggedIn, async (req, res) => {
  const { dominio, rutapdf} = req.params;
        const config = await pool.query('SELECT * FROM configuracion');
  const presupuesto = await pool.query('SELECT *, DATE_FORMAT(fecha_ingreso, "%d/%m/%y") AS fecha_ingreso FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, rutapdf]);

var pieza_reparar = JSON.parse(presupuesto[0].pieza_reparar);
var chapa_reparar = JSON.parse(presupuesto[0].chapa_reparar);
var pintura_reparar = JSON.parse(presupuesto[0].pintura_reparar);
var repuesto_reparar = JSON.parse(presupuesto[0].repuesto_reparar);
var mecanica_reparar = JSON.parse(presupuesto[0].mecanica_reparar);
var pieza_cambiar = JSON.parse(presupuesto[0].pieza_cambiar);
var chapa_cambiar = JSON.parse(presupuesto[0].chapa_cambiar);
var pintura_cambiar = JSON.parse(presupuesto[0].pintura_cambiar);
var mecanica_cambiar = JSON.parse(presupuesto[0].mecanica_cambiar);
var repuesto_cambiar = JSON.parse(presupuesto[0].repuesto_cambiar);

  var reparar_pdf = ``;
  var cambiar_pdf = ``;
  var total_chapa = 0;
  var total_pintura = 0;
  var total_mecanica = 0;
  var total_repuesto = 0;
  var total_varios = 0;
  if (pieza_reparar!=null && pieza_reparar.length>0){
    if (typeof pieza_reparar == 'string'){
     reparar_pdf = reparar_pdf + `<tr>
     <td>`+pieza_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+chapa_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+pintura_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_reparar+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_reparar+`</td></tr>`
     total_chapa = total_chapa + Number(chapa_reparar);
     total_pintura = total_pintura + Number(pintura_reparar);
     total_mecanica = total_mecanica + Number(mecanica_reparar);
     total_varios = total_varios + Number(repuesto_reparar);

    } else if (pieza_reparar.length>1){
   for (i=0; i<pieza_reparar.length; i++){
     reparar_pdf = reparar_pdf + `<tr>
     <td>`+pieza_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+chapa_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+pintura_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_reparar[i]+`</td>
     <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_reparar[i]+`</td></tr>`
     total_chapa = total_chapa + Number(chapa_reparar[i]);
     total_pintura = total_pintura + Number(pintura_reparar[i]);
     total_mecanica = total_mecanica + Number(mecanica_reparar[i]);
     total_varios = total_varios + Number(repuesto_reparar[i]);
   }
}}
if (pieza_cambiar!=null && pieza_cambiar.length>0){
 if (typeof pieza_cambiar == 'string'){
   var cambiar_pdf = cambiar_pdf + `<tr>
   <td>`+pieza_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+chapa_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+pintura_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_cambiar+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_cambiar+`</td></tr>`
   total_chapa = total_chapa + Number(chapa_cambiar);
   total_pintura = total_pintura + Number(pintura_cambiar);
   total_mecanica = total_mecanica + Number(mecanica_cambiar);
   total_repuesto = total_repuesto + Number(repuesto_cambiar);
 } else {
 for (j=0; j<pieza_cambiar.length; j++){
   var cambiar_pdf = cambiar_pdf + `<tr>
   <td>`+pieza_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+chapa_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+pintura_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+mecanica_cambiar[j]+`</td>
   <td style='border-left: 1px solid gray;text-align:center'>`+repuesto_cambiar[j]+`</td></tr>`
   total_chapa = total_chapa + Number(chapa_cambiar[j]);
   total_pintura = total_pintura + Number(pintura_cambiar[j]);
   total_mecanica = total_mecanica + Number(mecanica_cambiar[j]);
   total_repuesto = total_repuesto + Number(repuesto_cambiar[j]);
 }}
}
  if (total_chapa == 0){
    total_chapa = ''
   var ars_chapa=''
  } else {
    var ars_chapa = Math.trunc(Number(total_chapa) * Number(presupuesto[0].valor_chapa));
   }

   if (total_pintura == 0){
     total_pintura=''
     var ars_pintura=''
    } else {
     var ars_pintura = Math.trunc(Number(total_pintura) * Number(presupuesto[0].valor_pintura));
   }

     if (total_mecanica == 0){
       total_mecanica=''
       var ars_mecanica=''
      } else {
       var ars_mecanica = Math.trunc(Number(total_mecanica) * Number(presupuesto[0].valor_mecanica));
     }
     if (total_repuesto == 0){
       total_repuesto=''
     }
     if (total_varios == 0){
       total_varios=''
     }
     var total_mano = Math.trunc(Number(ars_chapa)+Number(ars_pintura)+Number(ars_mecanica)+Number(total_varios));
     if (total_mano == 0){
       total_mano=''
     }
     const total_presupuesto_ars = total_mano + total_repuesto;
const pdf = require('html-pdf');

   const pdf1 = `
   <!doctype html>

   <html>
      <head>
           <meta charset="utf-8">
        <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>

           <title>`+rutapdf+`</title>

         <style>
              * {
                   font-family: Arial, Helvetica, sans-serif;
               }
               html, body {
                   margin: 0;
                   padding: 0;

                 }


           </style>
       </head>
       <body>
       <div id="pageHeader" style="height:120px; margin-left: 10px;margin-right: 10px; margin-top:10px">
        <div style="border: groove;border-radius:10px; height:110px;">
       <img src="`+logosrc+`" alt="Taller Del Lago" height="100px" style="padding-left: 70px; padding-top:5px;"/>
           <div style="padding-right: 10%;text-align:center;float: right;;margin-top:5px">
             <h3 style="margin-bottom: 1px"><b>Taller de Chapa y Pintura<b></h3>
             <blockquote style="font-size:x-small;margin: 1px">Direccin: Anasagasti 1383<br/>
         <i class="far fa-envelope"></i> tallerdellagobrc@gmail.com</br>
         <i class="fab fa-whatsapp"></i> +54 9 294 453-9715</blockquote>
         <br />
           </div>
       </div>
     </div>

  <div style="border: groove; ;border-radius:10px; padding: 5px; margin-left: 10px;margin-right: 10px" >
               <div style="padding-bottom: 5px; padding-top: 5px">
           <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
           <br />
           <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
     <tr style="border-bottom: 1px solid gray; background-color: lightgray">
       <th>DATOS DEL CLIENTE</th>
       <th style="border-left: 1px solid gray">DATOS DEL VEHCULO</th>
     </tr>
     <tr >
       <td style="padding-right: 20%;">Nombre: <span style="float:right">`+presupuesto[0].nombre+`</span></td>
       <td style="border-left: 1px solid gray;padding-right: 20%;">Marca: <span style="float:right">`+presupuesto[0].marca+`</span></td>
     </tr>
     <tr>
       <td style="padding-right: 20%;">Compaa: <span style="float:right">`+presupuesto[0].compania+`</span></td>
       <td style="border-left: 1px solid gray;padding-right: 20%;">Modelo: <span style="float:right">`+presupuesto[0].modelo+`</span></td>
     </tr>
     <tr>
     <td style="padding-right: 20%;">Siniestro: <span style="float:right">`+presupuesto[0].siniestro+`</span></td>
     <td style="border-left: 1px solid gray;padding-right: 20%;">Dominio: <span style="float:right">`+presupuesto[0].dominio+`</span></td>
   </tr>
   <tr>
   <td style="padding-right: 20%;">Telfono: <span style="float:right">`+presupuesto[0].telefono+`</span></td>
   <td style="border-left: 1px solid gray;padding-right: 20%;">Color: <span style="float:right">`+presupuesto[0].color+`</span></td>
   </tr>
   </table>

             </div></div>
               <div style="padding-bottom: 5px">
               <h6 style="margin-top:10px;margin-bottom:5px">A REPARAR</h6>
               <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
               <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
         <tr style="border-bottom: 1px solid gray; background-color: lightgray;width: 320px">
           <th style="width:170px">Descripcin</th>
           <th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
           <th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
           <th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
           <th style="border-left: 1px solid gray; width: 100px">Varios <small>($)</small></th>

         </tr>
        `+reparar_pdf+`
       </table>

                 </div></div>
   <div style="padding-bottom: 5px" >
   <h6 style="margin-top:10px;margin-bottom:5px">A CAMBIAR</h6>
   <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
   <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
<tr style="border-bottom: 1px solid gray; background-color: lightgray"; width: 320px>
<th style="width:170px">Descripcin</th>
<th style="border-left: 1px solid gray; width: 100px">Chapa <small>(da)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Pintura <small>(pao)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Mecnica <small>(hora)</small></th>
<th style="border-left: 1px solid gray; width: 100px">Repuestos <small>($)</small></th>

</tr>
`+cambiar_pdf+`
</table>

     </div></div>
     <div style="padding-bottom: 5px">
     <h6 style="margin-top:10px;margin-bottom:5px">TOTALES</h6>
     <div style="margin: 0px;display:flex;flex-direction: row;justify-content: space-around;">
     <table style="width:100%;border: solid gray 1px;border-collapse: collapse;font-size:xx-small">
 <tr style="border-bottom: 1px solid gray; background-color: lightgray">
 <th >Descripcin</th>
 <th style="border-left: 1px solid gray">Cantidad</th>
 <th style="border-left: 1px solid gray">Total <small>($)</small></th>

 </tr>
 <tr >
 <td>Chapa <small>(da)</small></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_chapa+`</td>
 <td style="border-left: 1px solid gray;text-align:center">`+ars_chapa+`</td>
 </tr>
 <tr >
 <td>Pintura <small>(pao)</small></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_pintura+`</td>
 <td style="border-left: 1px solid gray;text-align:center">`+ars_pintura+`</td>
 </tr>
 <tr >
 <td >Mecnica <small>(hora)</small></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_mecanica+`</td>
 <td style="border-left: 1px solid gray;text-align:center">`+ars_mecanica+`</td>
 </tr>
 <tr >
 <td >Varios <small>($)</small></td>
 <td style="border-left: 1px solid gray;text-align:center"></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_varios+`</td>
 </tr>
 <tr style="border-bottom: 1px solid gray; border-top: 1px solid gray; background-color: lightgray">
 <td >Total mano de obra <small>($)</small> </td>
 <td></td>
 <td style="text-align:center">`+total_mano+`</td>
</tr>
 <tr >
 <td >Repuestos <small>($)</small></td>
 <td style="border-left: 1px solid gray;text-align:center"></td>
 <td style="border-left: 1px solid gray;text-align:center">`+total_repuesto+`</td>
 </tr>
 </table>

       </div></div>   <p style="font-size: 0.65rem">  <span style="float:left">PRESUPUESTO N: `+presupuesto[0].n_presupuesto+`</span> <span style="float:right">TOTAL: $`+total_presupuesto_ars+`.-

   `;

if (presupuesto[0].franquicia != '' && presupuesto[0].franquicia != null){
  var pdf2 = `<br />FRANQUICIA: $`+presupuesto[0].franquicia+`.-</span></p>

  <br/>
<p style="font-size:xx-small">Fecha `+presupuesto[0].fecha_ingreso+`</p>
<p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

</body>
</html>`;
} else if (presupuesto[0].franquicia == '' || presupuesto[0].franquicia == null) {
  var pdf2 =  `</span></p>
  <br/>
<p style="font-size:xx-small">Fecha `+presupuesto[0].fecha_ingreso+`</p>
<p style="font-size:xx-small">Presupuesto vlido por 15 das. Comprobante no vlido como factura.</p>

</body>
</html>`;
}

const contentpdf = pdf1 + pdf2;
pdf.create(contentpdf).toStream((err, stream) => {
  if (err) return res.end(err.stack)
res.setHeader('Content-type', 'application/pdf')
stream.pipe(res)

})


});



router.post('/nuevoturno', isLoggedIn,async (req, res) => {
  
  const { fecha_nuevoturno_i, fecha_nuevoturno_f, nuevoturno_dominio } = req.body;
  
   const boolturno = 1;
 
  const estado = "Turno otorgado"
  const nuevafechaturno_i = new Date(fecha_nuevoturno_i).toISOString().slice(0, 19).replace('T', ' ')
  if (fecha_nuevoturno_f != '' && fecha_nuevoturno_f != null && fecha_nuevoturno_f != undefined){
    const nuevafechaturno_f = new Date(fecha_nuevoturno_f).toISOString().slice(0, 19).replace('T', ' ')
     await pool.query('UPDATE presupuestos set fecha_turno_i = ?, fecha_turno_f = ?, turno = ?, estado = ? WHERE dominio = ? AND numero_pres = ?', [nuevafechaturno_i, nuevafechaturno_f, boolturno, estado, nuevoturno_dominio, 1]);
   
 await pool.query('UPDATE ordenes set fecha_turno_i = ?, fecha_turno_f = ?, estado = ? WHERE dominio = ?', [nuevafechaturno_i, nuevafechaturno_f, estado, nuevoturno_dominio]);
  } else {
    await pool.query('UPDATE presupuestos set fecha_turno_i = ?, fecha_turno_f = ?, turno = ?, estado = ? WHERE dominio = ? AND numero_pres = ?', [nuevafechaturno_i, nuevafechaturno_i, boolturno, estado, nuevoturno_dominio, 1]);
    await pool.query('UPDATE ordenes set fecha_turno_i = ?, fecha_turno_f = ?, estado = ? WHERE dominio = ?', [nuevafechaturno_i, nuevafechaturno_i, estado, nuevoturno_dominio]);
  }
   req.flash('success', 'Turno guardado correctamente');
   res.redirect('/ordenes')
  }

);

router.post('/eliminarturno',isLoggedIn, async (req, res) => {
  const { eliminarturno_dominio } = req.body;
  const boolturno = 0;
  await pool.query('UPDATE presupuestos set fecha_turno_i = ? , fecha_turno_f = ?, estado = ?, turno = ? WHERE dominio = ? AND numero_pres = ?', ["0000-00-00", "0000-00-00","Presupuestada", boolturno, eliminarturno_dominio, 1]);
  await pool.query('UPDATE ordenes set fecha_turno_i = ?, fecha_turno_f  = ? AND estado = ? WHERE dominio = ?', ["0000-00-00", "0000-00-00","Presupuestada", eliminarturno_dominio]);
   req.flash('success', 'Turno eliminado correctamente');
   res.redirect('/ordenes')
  }

);

router.post('/eliminarturno/:dominio',isLoggedIn, async (req, res) => {
  const { dominio} = req.params;
  const data = await pool.query('SELECT sobreturno FROM ordenes WHERE dominio = ?', [dominio]);
  if (data[0].sobreturno == 1){
    await pool.query('DELETE FROM ordenes WHERE dominio = ?', [dominio]);
  } else {
  const boolturno = 0;
  await pool.query('UPDATE presupuestos set fecha_turno_i = ?, fecha_turno_f = ? , estado = ?, completa = ?, turno = ? WHERE dominio = ? AND numero_pres = ?', ['0000-00-00','0000-00-00',"Presupuestada", 0, boolturno, dominio, 1]);
  await pool.query('UPDATE ordenes set fecha_turno_i = ?, fecha_turno_f = ?, completa = ? AND estado = ? WHERE dominio = ?', ['0000-00-00','0000-00-00',0,"Presupuestada", dominio]);

  }
  const completa = await pool.query('SELECT * FROM ordenes_completas WHERE dominio = ?', [dominio]);
  if (completa != null){
    await pool.query('DELETE FROM ordenes_completas WHERE dominio = ?', [dominio]);
  }
   req.flash('success', 'Turno eliminado correctamente');
   if (req.headers.referer.split('/')[3] == 'modificarturno'){
    res.redirect('/calendario')
  } else if (req.headers.referer.split('/')[3] == 'modificarturnomob'){
    res.redirect('/calendariomob')
  } else {
    res.redirect('/ordenes')
  }
  }

);

//ELIMINAR REGISTRO
router.post('/eliminarorden',isLoggedIn, async (req, res) => {
  const fsp = require('fs').promises
  const { eliminarorden_dominio } = req.body;
const directory = 'src/public/pdf/ordenes/';
  const ordenescargadas = await pool.query('SELECT orden_0, orden_A, orden_B, orden_C, orden_D, orden_E FROM ordenes WHERE dominio = ?', [eliminarorden_dominio]);
  if (ordenescargadas != ''){
var files = [
  ordenescargadas[0].orden_0 || null,
  ordenescargadas[0].orden_A  || null,
  ordenescargadas[0].orden_B  || null,
  ordenescargadas[0].orden_C  || null,
  ordenescargadas[0].orden_D  || null,
  ordenescargadas[0].orden_E  || null,
]

Promise.all(files.map(file => fsp.unlink('src/public/pdf/ordenes/'+file)))
  .then(() => {
  })
  .catch(err => {
  })
  }
  await pool.query('DELETE FROM presupuestos WHERE dominio = ?', [eliminarorden_dominio]);
  await pool.query('DELETE FROM ordenes WHERE dominio = ?', [eliminarorden_dominio]);

   req.flash('success', 'Orden eliminada correctamente');
   res.redirect('/ordenes')
  }

);

router.get('/eliminarordentrabajo/:dominio/:ordentrabajo/:pdforden', isLoggedIn, async (req, res) => {
  const {dominio, ordentrabajo, pdforden} = req.params;
  const orden = 'UPDATE ordenes set '+ordentrabajo+' = NULL WHERE dominio = "'+dominio+'"';
  await pool.query(orden);
  try {
    fs.unlinkSync('src/public/pdf/ordenes/'+pdforden)
  } catch(err) {
  }
  res.redirect('back')
  }

);

router.get('/eliminarpresupuestomob/:dominio/:presupuesto/:pdfpresupuesto',isLoggedIn, async (req, res) => {
  const {dominio, presupuesto, pdfpresupuesto} = req.params;
 await pool.query('UPDATE ordenes set '+presupuesto+' = NULL WHERE dominio = ?', [dominio]);
 const info =  await pool.query('SELECT * FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, pdfpresupuesto]);

 if (info[0].numero_pres != 1){
  await pool.query('DELETE FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, pdfpresupuesto]);
 } else {

 await pool.query('UPDATE presupuestos SET ruta_pdf = null, pieza_reparar = null, chapa_reparar = null, pintura_reparar = null, mecanica_reparar = null, repuesto_reparar = null, pieza_cambiar = null, chapa_cambiar = null, pintura_cambiar = null, mecanica_cambiar = null, repuesto_cambiar = null, total_presupuesto = null, franquicia = null WHERE dominio = ? AND ruta_pdf = ?', [dominio, pdfpresupuesto]);
 }
  res.redirect('/detalleregistro/'+dominio)
  }
);

router.get('/eliminarpresupuesto/:dominio/:presupuesto/:pdfpresupuesto',isLoggedIn, async (req, res) => {
  const {dominio, presupuesto, pdfpresupuesto} = req.params;
 await pool.query('UPDATE ordenes set '+presupuesto+' = NULL WHERE dominio = ?', [dominio]);
 const info =  await pool.query('SELECT * FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, pdfpresupuesto]);

 if (info[0].numero_pres != 1){
  await pool.query('DELETE FROM presupuestos WHERE dominio = ? AND ruta_pdf = ?', [dominio, pdfpresupuesto]);
 } else {

 await pool.query('UPDATE presupuestos SET ruta_pdf = null, pieza_reparar = null, chapa_reparar = null, pintura_reparar = null, mecanica_reparar = null, repuesto_reparar = null, pieza_cambiar = null, chapa_cambiar = null, pintura_cambiar = null, mecanica_cambiar = null, repuesto_cambiar = null, total_presupuesto = null, franquicia = null WHERE dominio = ? AND ruta_pdf = ?', [dominio, pdfpresupuesto]);
 }
  res.redirect('/ordenes')
  }
);

async function nuevaorden(req,res){
  const ordentrabajo = req.file.filename

  const {ordentrabajo_dominio } = req.body;
  const ordenescargadas = await pool.query('SELECT * FROM ordenes WHERE dominio = ?', [ordentrabajo_dominio]);
 if (ordenescargadas[0].orden_0 == null){
  await pool.query('UPDATE ordenes set orden_0 =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 } else if (ordenescargadas[0].orden_A == null){
  await pool.query('UPDATE ordenes set orden_A =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }else if (ordenescargadas[0].orden_B == null){
  await pool.query('UPDATE ordenes set orden_B =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }else if (ordenescargadas[0].orden_C == null){
  await pool.query('UPDATE ordenes set orden_C =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }else if (ordenescargadas[0].orden_D == null){
  await pool.query('UPDATE ordenes set orden_D =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
}else if (ordenescargadas[0].orden_E == null){
  await pool.query('UPDATE ordenes set orden_E =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }
 req.flash('success', 'Orden cargada correctamente')
 res.redirect('/ordenes')

}


router.post('/nuevaorden',[upload.single('ordentrabajo'), nuevaorden],isLoggedIn, async (req, res,next) => {
next(req.body);
}
);

async function nuevaordenturno(req,res){
  const ordentrabajo = req.file.filename
  const ordentrabajo_dominio = req.params.dominio;
  const ordenescargadas = await pool.query('SELECT * FROM ordenes WHERE dominio = ?', [ordentrabajo_dominio]);
 if (ordenescargadas[0].orden_0 == null){
  await pool.query('UPDATE ordenes set orden_0 =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 } else if (ordenescargadas[0].orden_A == null){
  await pool.query('UPDATE ordenes set orden_A =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }else if (ordenescargadas[0].orden_B == null){
  await pool.query('UPDATE ordenes set orden_B =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }else if (ordenescargadas[0].orden_C == null){
  await pool.query('UPDATE ordenes set orden_C =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }else if (ordenescargadas[0].orden_D == null){
  await pool.query('UPDATE ordenes set orden_D =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
}else if (ordenescargadas[0].orden_E == null){
  await pool.query('UPDATE ordenes set orden_E =? WHERE dominio = ?', [ordentrabajo, ordentrabajo_dominio]);
 }
 res.redirect('/modificarturno/'+ordentrabajo_dominio)

}


router.post('/nuevaordenturno/:dominio',[upload.single('ordentrabajo'), nuevaordenturno],isLoggedIn, async (req, res,next) => {
next(req.body, req.params);
}
);




/*CALENDARIO*/

router.get('/feriados.json', isLoggedIn, async (req, res, next) =>{
    const feriados = await pool.query('SELECT * FROM feriados');
    var feriados_db = []

    for (i=0; i<feriados.length; i++){
        var feriado = {
          title: feriados[i].motivo,
          start: feriados[i].fecha,
          allDay: true,
          display: 'background',
          backgroundColor: 'red'

        }

        feriados_db.push(feriado)
    }
    res.json(feriados_db)
});

router.get('/ordenescompletas.json', isLoggedIn, async (req, res, next) =>{
  const turnoscompletos = await pool.query('SELECT * FROM ordenes_completas');
  var turnoscompletos_db = []
  if (turnoscompletos.length>=1){
  for (i=0; i<turnoscompletos.length; i++){
    const fecha_T = (String(turnoscompletos[i].fecha_turno_f.toISOString())).split('T')
    const dia = fecha_T[0].split('-')
    const dia_act = String(Number(String((String(turnoscompletos[i].fecha_turno_f.toISOString()).split('-'))[2]).split('T')[0])+1).padStart(2,'0');

    dia[2] = dia_act;
    var fecha_fin_act = String(dia[0] + '-' + dia[1] + '-' + dia[2] + 'T' + fecha_T[1])
      var turno_nuevo = {
        title: turnoscompletos[i].dominio + ' | ' + turnoscompletos[i].nombre,
        start: turnoscompletos[i].fecha_turno_i,
	end: fecha_fin_act,
        allDay: true,
        color: '#5cb85c',
        textColor: 'black',
        extendedProps: {
          'particular': turnoscompletos[i].turno_particular,
          'sobreturno': turnoscompletos[i].sobreturno,
          'dominio': turnoscompletos[i].dominio,
          'estado': turnoscompletos[i].estado,
          'observacion': turnoscompletos[i].obs_particular,
 'fecha_fin': turnoscompletos[i].fecha_turno_f
        }

      }
      turnoscompletos_db.push(turno_nuevo)



          if (turnoscompletos[i].presupuesto_0 !=null){
            turno_nuevo['presupuesto_0'] = turnoscompletos[i].presupuesto_0;
            turno_nuevo['observacion_0'] = turnoscompletos[i].observacion_0;
          }
          if (turnoscompletos[i].presupuesto_A !=null){
            turno_nuevo['presupuesto_A'] = turnoscompletos[i].presupuesto_A;
            turno_nuevo['observacion_A'] = turnoscompletos[i].observacion_A;
          }
          if (turnoscompletos[i].presupuesto_B !=null){
            turno_nuevo['presupuesto_B'] = turnoscompletos[i].presupuesto_B;
            turno_nuevo['observacion_B'] = turnoscompletos[i].observacion_B;

          }
          if (turnoscompletos[i].presupuesto_C !=null){
            turno_nuevo['presupuesto_C'] = turnoscompletos[i].presupuesto_C;
            turno_nuevo['observacion_C'] = turnoscompletos[i].observacion_C;

          }
          if (turnoscompletos[i].presupuesto_D !=null){
            turno_nuevo['presupuesto_D'] = turnoscompletos[i].presupuesto_D;
            turno_nuevo['observacion_D'] = turnoscompletos[i].observacion_D;

          }
          if (turnoscompletos[i].presupuesto_E !=null){
            turno_nuevo['presupuesto_E'] = turnoscompletos[i].presupuesto_E;
            turno_nuevo['observacion_E'] = turnoscompletos[i].observacion_E;

          }
          if (turnoscompletos[i].orden_0 !=null){
            turno_nuevo['orden_0'] = turnoscompletos[i].orden_0
          }
          if (turnoscompletos[i].orden_A !=null){
            turno_nuevo['orden_A'] = turnoscompletos[i].orden_A
          }
          if (turnoscompletos[i].orden_B !=null){
            turno_nuevo['orden_B'] = turnoscompletos[i].orden_B
          }
          if (turnoscompletos[i].orden_C !=null){
            turno_nuevo['orden_C'] = turnoscompletos[i].orden_C
          }
          if (turnoscompletos[i].orden_D !=null){
            turno_nuevo['orden_D'] = turnoscompletos[i].orden_D
          }
          if (turnoscompletos[i].orden_E !=null){
            turno_nuevo['orden_E'] = turnoscompletos[i].orden_E
          }
  }
  for (j=0; j<turnoscompletos_db.length; j++){

  if (turnoscompletos_db[j].extendedProps.particular == 1){
    turnoscompletos_db[j].borderColor = '#5C1BA8';
    turnoscompletos_db[j].textColor = '#5C1BA8';
  }
  if (turnoscompletos_db[j].extendedProps.sobreturno == 1){
    turnoscompletos_db[j].borderColor = 'saddlebrown';
    turnoscompletos_db[j].textColor = 'saddlebrown';
  }
}
  }
  res.json(turnoscompletos_db);

});

router.get('/calendario.json', isLoggedIn, async (req, res, next) =>{
    const turnos = await pool.query('SELECT * FROM ordenes');
    var turnos_db = []
    if (turnos.length>=1){
    for (i=0; i<turnos.length; i++){
if (turnos[i].fecha_turno_f != null && turnos[i].fecha_turno_f != '0000-00-00') {
                const fecha_T = (String(turnos[i].fecha_turno_f.toISOString())).split('T')
      const dia = fecha_T[0].split('-')
      const dia_act = String(Number(String((String(turnos[i].fecha_turno_f.toISOString()).split('-'))[2]).split('T')[0])+1).padStart(2,'0');

      dia[2] = dia_act;
      var fecha_fin_act = String(dia[0] + '-' + dia[1] + '-' + dia[2] + 'T' + fecha_T[1])
}
      if (turnos[i].estado == "Presupuestada"){
        continue
    } else if (turnos[i].estado == "Finalizada"){
             var turno_nuevo = {
        title: turnos[i].nombre + ' | ' + turnos[i].dominio,
        start: turnos[i].fecha_turno_i,
        end: fecha_fin_act,
        allDay:true,
        color: '#28a745',
        textColor: 'black',
        extendedProps: {
          'particular': turnos[i].turno_particular,
          'sobreturno': turnos[i].sobreturno,
          'dominio': turnos[i].dominio,
          'estado': turnos[i].estado,
          'observacion': turnos[i].obs_particular,
	'fecha_inicio': turnos[i].fecha_turno_i,
          'fecha_fin': turnos[i].fecha_turno_f
        }

      }
      turnos_db.push(turno_nuevo)
    }  else if (turnos[i].fecha_turno_i == "0000-00-00"){
      continue
      } else if (turnos[i].estado == "Turno otorgado"){

        var turno_nuevo = {
          title: turnos[i].nombre + ' | ' + turnos[i].dominio,
          start: turnos[i].fecha_turno_i,
          allDay: true,
          color: '#f0ad4e',
          textColor: 'black',
          extendedProps: {
            'particular': turnos[i].turno_particular,
            'sobreturno': turnos[i].sobreturno,
            'dominio': turnos[i].dominio,
            'estado': turnos[i].estado,
            'observacion': turnos[i].obs_particular,
	'fecha_inicio': turnos[i].fecha_turno_i,
            'fecha_fin': turnos[i].fecha_turno_f

          }

        }
        turnos_db.push(turno_nuevo)

        } else if (turnos[i].estado == "En reparacin"){
            var turno_nuevo = {
                title: turnos[i].nombre + ' | ' + turnos[i].dominio,
                start: turnos[i].fecha_turno_i,
                allDay: true,
                color: '#0275d8',
                textColor: 'black',
                extendedProps: {
                  'particular': turnos[i].turno_particular,
                  'sobreturno': turnos[i].sobreturno,
                  'dominio': turnos[i].dominio,
                  'estado': turnos[i].estado,
                  'observacion': turnos[i].obs_particular,
	'fecha_inicio': turnos[i].fecha_turno_i,
		                  'fecha_fin': turnos[i].fecha_turno_f


                }
              }
              turnos_db.push(turno_nuevo)

            } else if (turnos[i].estado == "Cancelada"){
                var turno_nuevo = {
                    title: turnos[i].nombre + ' | ' + turnos[i].dominio,
                    start: turnos[i].fecha_turno_i,
			end: fecha_fin_act,
                    allDay: true,
                    color: '#d9534f',
                    textColor: 'black',
                    extendedProps: {
                      'particular': turnos[i].turno_particular,
                      'sobreturno': turnos[i].sobreturno,
                      'dominio': turnos[i].dominio,
                      'estado': turnos[i].estado,
                      'observacion': turnos[i].obs_particular,
	'fecha_inicio': turnos[i].fecha_turno_i,
		                  'fecha_fin': turnos[i].fecha_turno_f


                    }
                  }
                  turnos_db.push(turno_nuevo)

            }
            if (turnos[i].fecha_turno_f ==null){
              turno_nuevo['end'] = turnos[i].fecha_turno_i;
            }else{
turno_nuevo['end'] = fecha_fin_act;
}
            if (turnos[i].presupuesto_0 !=null){
              turno_nuevo['presupuesto_0'] = turnos[i].presupuesto_0;
              turno_nuevo['observacion_0'] = turnos[i].observacion_0;
            }
            if (turnos[i].presupuesto_A !=null){
              turno_nuevo['presupuesto_A'] = turnos[i].presupuesto_A;
              turno_nuevo['observacion_A'] = turnos[i].observacion_A;
            }
            if (turnos[i].presupuesto_B !=null){
              turno_nuevo['presupuesto_B'] = turnos[i].presupuesto_B;
              turno_nuevo['observacion_B'] = turnos[i].observacion_B;

            }
            if (turnos[i].presupuesto_C !=null){
              turno_nuevo['presupuesto_C'] = turnos[i].presupuesto_C;
              turno_nuevo['observacion_C'] = turnos[i].observacion_C;

            }
            if (turnos[i].presupuesto_D !=null){
              turno_nuevo['presupuesto_D'] = turnos[i].presupuesto_D;
              turno_nuevo['observacion_D'] = turnos[i].observacion_D;

            }
            if (turnos[i].presupuesto_E !=null){
              turno_nuevo['presupuesto_E'] = turnos[i].presupuesto_E;
              turno_nuevo['observacion_E'] = turnos[i].observacion_E;

            }
            if (turnos[i].orden_0 !=null){
              turno_nuevo['orden_0'] = turnos[i].orden_0
            }
            if (turnos[i].orden_A !=null){
              turno_nuevo['orden_A'] = turnos[i].orden_A
            }
            if (turnos[i].orden_B !=null){
              turno_nuevo['orden_B'] = turnos[i].orden_B
            }
            if (turnos[i].orden_C !=null){
              turno_nuevo['orden_C'] = turnos[i].orden_C
            }
            if (turnos[i].orden_D !=null){
              turno_nuevo['orden_D'] = turnos[i].orden_D
            }
            if (turnos[i].orden_E !=null){
              turno_nuevo['orden_E'] = turnos[i].orden_E
            }
    }
    for (j=0; j<turnos_db.length; j++){

    if (turnos_db[j].extendedProps.particular == 1){
      turnos_db[j].borderColor = '#5C1BA8';
      turnos_db[j].textColor = '#5C1BA8';
    }
    if (turnos_db[j].extendedProps.sobreturno == 1){
      turnos_db[j].borderColor = 'saddlebrown';
      turnos_db[j].textColor = 'saddlebrown';
    }
  }}
    res.json(turnos_db);

});

router.get('/calendario', isLoggedIn, async (req, res) => {
    res.render('links/calendario');
});

router.get('/calendariomob', isLoggedIn, async (req, res) => {
  res.render('links/calendariomob');
});

router.post('/calendario',isLoggedIn, async (req, res) => {
    const {fecha_nuevoturno, nombre_nuevoturno, dominio_nuevoturno, orden_nuevoturno, telefono_nuevoturno
    } = req.body;

    const nuevoTurno = {
          nombre: nombre_nuevoturno,
          dominio: dominio_nuevoturno,
          telefono: telefono_nuevoturno,
          orden_0: orden_nuevoturno || null,
         estado: "Turno otorgado",
         turno_particular: 1,
         fecha_turno: fecha_nuevoturno,
         fecha_estado: new Date().toISOString().slice(0, 19).replace('T', ' ')
    };

   await pool.query('INSERT INTO ordenes set ?', [nuevoTurno]);

   res.redirect('/calendario')
});

async function nuevoturnoparticular(req,res){
  const {fecha_nuevoturno_i, fecha_nuevoturno_f, nombre_nuevoturno, dominio_nuevoturno, telefono_nuevoturno, obs_nuevoturno} = req.body;
  if (typeof req.file == 'undefined'){
    var archivo = null;
  } else {
    var archivo = req.file.filename;
  }

 if (obs_nuevoturno != ''){
    if (fecha_nuevoturno_f != '' && fecha_nuevoturno_f != null && fecha_nuevoturno_f != undefined){
  var nuevoTurno = {
    nombre: nombre_nuevoturno,
    dominio: dominio_nuevoturno,
    telefono: telefono_nuevoturno,
    orden_0: archivo,
   estado: "Turno otorgado",
   sobreturno: 1,
   fecha_turno_i: fecha_nuevoturno_i,
   fecha_turno_f: fecha_nuevoturno_f,

   fecha_estado: new Date().toISOString().slice(0, 19).replace('T', ' '),
   obs_particular: obs_nuevoturno
};
  }
  else {
    var nuevoTurno = {
      nombre: nombre_nuevoturno,
      dominio: dominio_nuevoturno,
      telefono: telefono_nuevoturno,
      orden_0: archivo,
     estado: "Turno otorgado",
     sobreturno: 1,
     fecha_turno_i: fecha_nuevoturno_i,
fecha_turno_f: fecha_nuevoturno_i,
     fecha_estado: new Date().toISOString().slice(0, 19).replace('T', ' '),
     obs_particular: obs_nuevoturno
 };
  }}
  else {
    if (fecha_nuevoturno_f != '' && fecha_nuevoturno_f != null && fecha_nuevoturno_f != undefined){
      var nuevoTurno = {
        nombre: nombre_nuevoturno,
        dominio: dominio_nuevoturno,
        telefono: telefono_nuevoturno,
        orden_0: archivo,
       estado: "Turno otorgado",
       sobreturno: 1,
       fecha_turno_i: fecha_nuevoturno_i,
       fecha_turno_f: fecha_nuevoturno_f,
       fecha_estado: new Date().toISOString().slice(0, 19).replace('T', ' ')  };
    
    } else {
    var nuevoTurno = {
      nombre: nombre_nuevoturno,
      dominio: dominio_nuevoturno,
      telefono: telefono_nuevoturno,
      orden_0: archivo,
     estado: "Turno otorgado",
     sobreturno: 1,
     fecha_turno_i: fecha_nuevoturno_i,
     fecha_turno_f: fecha_nuevoturno_i,
     fecha_estado: new Date().toISOString().slice(0, 19).replace('T', ' ')  };
    
  
  }}
  

await pool.query('INSERT INTO ordenes set ?', [nuevoTurno]);
res.redirect('/calendario')

}
router.post('/nuevoturnoparticular',[upload.single('orden_nuevoturno'), nuevoturnoparticular],isLoggedIn, async (req, res,next) => {
  next(req.body);
  }
  );

async function nuevoturnoparticularmob(req,res){
  const {fecha_nuevoturno, nombre_nuevoturno, dominio_nuevoturno, telefono_nuevoturno, obs_nuevoturno} = req.body;
  if (typeof req.file == 'undefined'){
    var archivo = null;
  } else {
    var archivo = req.file.filename;
  }
  const nuevoTurno = {
    nombre: nombre_nuevoturno,
    dominio: dominio_nuevoturno,
    telefono: telefono_nuevoturno,
    orden_0: archivo,
   estado: "Turno otorgado",
   sobreturno: 1,
   fecha_turno: fecha_nuevoturno,
   fecha_estado: new Date().toISOString().slice(0, 19).replace('T', ' '),
   obs_particular: obs_nuevoturno
};

await pool.query('INSERT INTO ordenes set ?', [nuevoTurno]);
res.redirect('/calendariomob')

}
router.post('/nuevoturnoparticularmob',[upload.single('orden_nuevoturno'), nuevoturnoparticularmob],isLoggedIn, async (req, res,next) => {
  next(req.body);
  }
  );






router.get('/modificarturno/:dominio', isLoggedIn, async (req, res) => {
  const {dominio} = req.params;
  const turno = await pool.query('SELECT *, DATE_FORMAT(fecha_turno_i, "%Y-%m-%d") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%Y-%m-%d") AS fecha_turno_f  FROM ordenes WHERE dominio = ?', [dominio]);
  
  const datospresupuesto = await pool.query('SELECT * , DATE_FORMAT(fecha_turno_i, "%Y-%m-%d") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%Y-%m-%d") AS fecha_turno_f  FROM presupuestos WHERE dominio = ? AND numero_pres = ?', [dominio,1]);

  res.render('links/modificarturno', {turno, datospresupuesto});
});


router.get('/modificarturnomob/:dominio', isLoggedIn, async (req, res) => {
  const {dominio} = req.params;
 const turno = await pool.query('SELECT *, DATE_FORMAT(fecha_turno_i, "%Y-%m-%d") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%Y-%m-%d") AS fecha_turno_f  FROM ordenes WHERE dominio = ?', [dominio]);
 const datospresupuesto = await pool.query('SELECT * , DATE_FORMAT(fecha_turno_i, "%Y-%m-%d") AS fecha_turno_i, DATE_FORMAT(fecha_turno_f, "%Y-%m-%d") AS fecha_turno_f  FROM presupuestos WHERE dominio = ? AND numero_pres = ?', [dominio,1]);
  res.render('links/modificarturnomob', {turno, datospresupuesto});
});

router.post('/actualizarturno/:dominio',isLoggedIn, async (req, res) => {
  const {dominio} = req.params;
  const { fecha_nuevoturno_i, fecha_nuevoturno_f, estado_nuevoturno } = req.body;
  
 await pool.query('UPDATE presupuestos set fecha_turno_i = ?, fecha_turno_f = ?, estado = ? WHERE dominio = ? AND numero_pres = ?', [fecha_nuevoturno_i, fecha_nuevoturno_f, estado_nuevoturno, dominio, 1]);

await pool.query('UPDATE ordenes set fecha_turno_i = ?, fecha_turno_f = ?, estado = ? WHERE dominio = ?', [fecha_nuevoturno_i, fecha_nuevoturno_f, estado_nuevoturno, dominio]);

  if (estado_nuevoturno == 'Finalizada'){
    await pool.query('UPDATE presupuestos set completa = ? WHERE dominio = ? AND numero_pres = ?', [1, dominio, 1]);
    await pool.query('UPDATE ordenes set completa = ? WHERE dominio = ?', [1, dominio]);
   


  } else {
    await pool.query('UPDATE presupuestos set completa = ? WHERE dominio = ? AND numero_pres = ?', [0, dominio, 1]);
    await pool.query('UPDATE ordenes set completa = ? WHERE dominio = ?', [0, dominio]);

  }
 req.flash('success', 'Turno actualizado correctamente');

    res.redirect('/calendario')

  
});

/*CONFIGURACION*/

router.get('/configuracion', isLoggedIn, async  (req, res) => {
  const username = req.user.username;
  const valoresconfig = await pool.query('SELECT * FROM configuracion');
  const autopartes = await pool.query('SELECT * FROM autopartes ORDER BY nombre_pieza ASC');
  const cuenta = await pool.query('SELECT username, fullname FROM users WHERE username = ?', username);
    res.render('links/configuracion', { valoresconfig, autopartes, cuenta });
});

router.post('/configuracion', isLoggedIn, async  (req, res) => {
  const {chapa_dia, pintura_pano, mecanica_hora} = req.body;

  const nuevaconfig = {
      chapa_dia,
      pintura_pano,
      mecanica_hora
  };

 await pool.query('UPDATE configuracion set ? WHERE id = 1', [nuevaconfig]);
 req.flash('success', 'Valores actualizados correctamente')
 res.redirect('/configuracion');
});

router.post('/nuevapieza',isLoggedIn, async (req, res) => {
  const { nombre_pieza
  } = req.body;

  const nuevapieza = {
    nombre_pieza
};

 await pool.query('INSERT INTO autopartes set ?', [nuevapieza]);
 req.flash('success', 'Pieza cargada correctamente');
 res.redirect('/configuracion')
});

router.post('/eliminarpieza',isLoggedIn, async (req, res) => {
  const { piezaeliminar
  } = req.body;


 await pool.query('DELETE FROM autopartes WHERE nombre_pieza = ?', piezaeliminar);
 req.flash('success', 'Pieza eliminada correctamente');
 res.redirect('/configuracion')
});

router.post('/editarpieza',isLoggedIn, async (req, res) => {
  const { piezaeditar, piezaeditarvieja
  } = req.body;


 await pool.query('UPDATE autopartes set nombre_pieza = ? WHERE nombre_pieza = ?', [piezaeditar, piezaeditarvieja]);
 req.flash('success', 'Pieza actualizada correctamente');
 res.redirect('/configuracion')
});


module.exports = router;
